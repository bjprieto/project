#!/bin/bash
# getbooks.sh



# Input Quality Control

# quality control: one argument
if ! [[ $# -eq 1 ]]
then
    1>&2 printf 'invalid number of arguments; expected 1, got %d\n' $#
    exit
fi

# quality control: UTF-8 format
if ! $(grep -Eoq 'https://www.gutenberg.org/ebooks/[[:digit:]]+\.txt\.utf-8' $1)
then
    1>&2 printf 'invalid file format; expected at least one web address in plain text UTF-8 format'
    exit
fi


# Primary Function

# perform downloads
for web in $(cat $1)
do
    # extract temporary file name
    file=$(echo $web | grep -Eo '[[:digit:]]+\.txt\.utf-8')
    # echo $file # check extraction

    # check if file is preexisting with default wget name
    if ! [[ -f $file ]]
    then

	# download book and extract relevant information
	wget -q $web
        title=$(head -1 $file | sed 's/.\+[Ee]Book[[:space:]]of[[:space:]]//; s/,.\+//; s/[[:punct:]]//g; s/\ /_/g' | tr [:upper:] [:lower:])
	author=$(head -1 $file | sed 's/.\+,[[:space:]]by[[:space:]]//; s/[[:space:]]$//;s/[[:punct:]]//g; s/\ /_/g' | tr [:upper:] [:lower:])

	# check block for info extraction
	# echo $title
	# echo $author

	# check author directory exists
	if ! [[ -d $author ]]
	   
	then # create corresponding directory and file
	    mkdir $author
	    mv $file "$author/$title.txt"
	    
	else # check book exists in the preexisting directory, else move book.txt
	    if ! [[ -f "$author/$title.txt" ]]
	    then
       		mv $file "$author/$title.txt"
	    fi
	fi
    else
	title=$(head -1 $file | sed 's/.\+[Ee]Book[[:space:]]of[[:space:]]//; s/,.\+//; s/[[:punct:]]//g; s/\ /_/g' | t\│
r [:upper:] [:lower:])                                                                                                  │aldous_huxley/chrome_yellow.txt
        author=$(head -1 $file | sed 's/.\+,[[:space:]]by[[:space:]]//; s/[[:space:]]$//;s/[[:punct:]]//g; s/\ /_/g' | \│
tr [:upper:] [:lower:])                                                                                                 │Note that you should account for the fact that there could be multiple books by the same a
                                                                                                                        │uthor so a directory might already exist even if a particular book by the author has not y
        # check block for info extraction                                                                               │et been downloaded.
        # echo $title                                                                                                   │
        # echo $author                                                                                                  │Syntax:
                                                                                                                        │
        # check author directory exists                                                                                 │The getbooks.sh script should run with the following command:
        if ! [[ -d $author ]]                                                                                           │
                                                                                                                        │./getbooks book_list
        then # create corresponding directory and file                                                                  │
            mkdir $author                                                                                               │where book_list is a text file containing a list of web addresses for books in UTF-8 text 
            mv $file "$author/$title.txt"                                                                               │format on Gutenberg.org.
                                                                                                                        │
        else # check book exists in the preexisting directory, else move book.txt                                       │General Features:
            if ! [[ -f "$author/$title.txt" ]]                                                                          │
            then                                                                                                        │:
                mv $file "$author/$title.txt"                                                                           ├──────────────────────────────────────────────────────────────────────────────────────────
            fi                                                                                                          │[13:48]:[~]$ cd repos/project5/test/
        fi 
    fi
done
